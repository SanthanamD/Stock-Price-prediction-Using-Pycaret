# -*- coding: utf-8 -*-
"""Stock prediction using Pycaret.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1_RmaQzD5j0NvL_0Zn9l1F4jxM-YfCONq
"""

pip install pycaret

pip install markupsafe==2.0.1

pip install jinja2

#Import Libraries
import numpy as np
import pandas as pd
from pycaret.regression import *
from sklearn.model_selection import train_test_split

#Load Dataset - if you have dataset, you can upload the files using this method
#from google.colab import files
#files.upload()

pip install yfinance

pip install --upgrade mplfinance

import yfinance as yf
import mplfinance as mpf

from pandas_datareader import data as pdr

yf.pdr_override()

##Reading the data from yahoo finance using pandas datareader
df=pdr.get_data_yahoo("^NSEI",start="2023-01-02",end="2023-02-06")

#Visualizing the data
mpf.plot(df,type='candle',ylabel='Price INR',title="Nifty50 Spot value",volume=True,ema=(9,21,49),style='yahoo')

df

#Resetting the index to get Date Column
df2=df.reset_index()

df2

df2.columns

#Add target
X=np.array(df2[['Date','Open','Close']])

#Store the close price as an array in a variable name 'Y'.
y=df2['Close'].values

#Split the data into 85% & 15% for training and testing
X_train,X_test,y_train,y_test=train_test_split(X,y,test_size=0.15,random_state=0,shuffle=False)

#Get the train data and transform into Dataframe
train_data=pd.DataFrame(X_train,columns=['Date','Open','Close'])
train_data.head(7)

#Get the test data and transform into Dataframe
test_data=pd.DataFrame(X_test,columns=['Date','Open','Close'])
test_data.head(7)

#Initialize the set up
s=setup(data=train_data,target='Close',session_id=123,use_gpu=True)

#Train on multiple models and compare them
compare_models(sort='MSE')

#Create a model
model=create_model('en')

#Get Predictions
y_pred=predict_model(model,data=test_data.drop(['Close'],axis=1))
y_pred

#Show the actual values
test_data['Close']